{% extends 'index/base.html' %}
{% load static %}
{% block title %}
<title>{{title}}</title>
{% endblock %}
{% block content %}
<div class="row" style="margin-top: 30px;">
    <div style="text-align: center">
        <label for="productSearch">產品搜尋:</label>
        <input type="text" id="productSearch" name="productSearch">
        <button onclick="filterProducts()">搜尋</button>
    </div>
    <div class="container " style="margin-top: 30px;">
    <div class="row">
        <div class="col d-flex justify-content-center"><button class="number-btn  text-center mb-2 btn-info" data-category="1"> 現貨 </button></div>
        <div class="col d-flex justify-content-center"><button class="number-btn  text-center mb-2 btn-info" data-category='0'> 預售 </button></div>        
    </div>
    </div>
    <div class="container" style="margin-top: 30px; text-align: center;">
        <button class="category-all-btn text-center mb-2 btn-info" data-category="all"> 全部 </button>
        {% for category in categories_modified %}
        <button class="category-btn text-center mb-2 btn-info" data-category="{{ category.id }}">{{ category.Category_name }}</button>
        {% endfor %}
    </div>

    <div class="container" style="margin-top: 30px;">
        <div class="row">

            {% for product_info in page_obj %} <!-- 迭代分頁對象中的每個產品信息 -->
            <div class="col-lg-3 col-md-4 mb-4" data-category-id="{{ product_info.Category_id }}" data-number="{{ product_info.Number }}">
                <div class="card text-center">
                    <img src="{{ product_info.Picture.0 }}" style="margin: auto;" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">{{ product_info.Product }}</h5> <!-- 設置產品名稱 -->
                        <p class="card-text">{{ product_info.Price }}</p>
                        <p class="card-text">{{ product_info.Specification }}</p>
                        <a href="{% url 'Product:detail' branch=branch.id detail=product_info.id  %}"
                            class="btn btn-primary">商品資訊</a>
                    </div>
                </div>
            </div>
            {% endfor %}

        </div>
    </div>
</div>
<div class="text-center">

    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">« Previous page</a>

    {% endif %}
    {% if page_obj.number > 3 %}

    <a href="?page=1">1</a>
    {% endif %}
    {% if page_obj.number > 4 %}
    <span>...</span>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
    {% if page_obj.number == num %}
    <a href="?page={{ num }}">{{ num }}</a>
    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a href="?page={{ num }}">{{ num }}</a>
        {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %} <span>...</span>
            <a href="?page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
            {% elif page_obj.number < page_obj.paginator.num_pages|add:'-2' %} <a
                href="?page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
                {% endif %}

                <a href="?page={{ page_obj.next_page_number }}">Next Page »</a>

                {% endif %}
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 選取所有類別按鈕和產品卡片
        const categoryButtons = document.querySelectorAll('.category-btn, .category-all-btn');
        const productCards = document.querySelectorAll('.col-lg-3');
        // 為每個類別按鈕添加點擊事件監聽器
        categoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                const categoryId = button.dataset.category; // 獲取按鈕的類別ID
                // console.log(productCards)
                // 根據類別ID顯示或隱藏產品卡片
                productCards.forEach(card => {
                    if (categoryId === 'all' || card.dataset.categoryId === categoryId) {
                        console.log(card.dataset.categoryId)
                        console.log(card.dataset)
                        console.log(card)
                        card.style.display = ''; // 顯示卡片
                    } else {
                        card.style.display = 'none'; // 隱藏卡片
                    }
                });
            });
        });
    });
    // 判斷現貨預售
    document.addEventListener("DOMContentLoaded", function () {
        const NumberButtons = document.querySelectorAll('.number-btn');
        const productCards = document.querySelectorAll('.col-lg-3');
        // 為每個類別按鈕添加點擊事件監聽器
        NumberButtons.forEach(button => {
            button.addEventListener('click', () => {
                const categoryId = button.dataset.category; // 獲取按鈕的類別ID
                // console.log(categoryId)
                // 根據類別ID顯示或隱藏產品卡片
                productCards.forEach(card => {
                    if(card.dataset.number>=0){
                        stock=1
                    }else{
                        stock=0
                    }
                    if ( stock == categoryId) {
                        card.style.display = ''; // 顯示卡片
                    } else {
                        card.style.display = 'none'; // 隱藏卡片
                    }
                });
            });
        });
    });
</script>

{% endblock %}